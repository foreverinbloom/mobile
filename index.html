<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rooted in the Word üå± | MBC</title>

<style>
:root{
  --border:#cfcfcf;
  --ink:#111;
  --muted:#666;
  --panel:#fff;
  --bg:#fff;
  --reflectionInk:#1E293B;
}

body{
  margin:0;
  background:var(--bg);
  font-family: system-ui, -apple-system, Segoe UI, Arial, sans-serif;
  color:var(--ink);
}

.wrap{
  padding:14px;
  max-width:520px;
  margin:0 auto;
}

/* Panel */
.revealCard{
  border:3px solid var(--ink);
  border-radius:18px;
  padding:14px;
  background:var(--panel);
  display:grid;
  gap:12px;
}

/* Titles / rows */
.revealTitle{
  font-weight:900;
  font-size:18px;
}

.keyRow,
.practiceRow{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:10px;
}

.keyRowStacked{
  flex-direction:column;
  align-items:flex-start;
}

.keyLabel{
  font-weight:900;
  font-size:14px;
}

.btnRow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  align-items:center;
}

.btnColumn{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:6px;
  align-items:flex-start;
}

button{
  -webkit-appearance:none;
  appearance:none;
  border:1px solid var(--border);
  background:#fff;
  border-radius:10px;
  padding:8px 10px;
  font-weight:800;
  cursor:pointer;
}

.miniBtn{
  padding:6px 8px;
  font-size:12px;
  border-radius:9px;
}

/* Source textarea */
.keyInput{
  width:100%;
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  font-size:14px;
  font-weight:700;
  resize:vertical;
  min-height:120px;
  box-sizing:border-box;
}

.keyHiddenNote{
  border:1px dashed var(--border);
  border-radius:12px;
  padding:10px;
  font-size:14px;
  color:var(--muted);
  font-weight:700;
  background:#fafafa;
}

/* Divider */
.softRule{
  border:none;
  border-top:1px solid #e5e5e5;
  margin:2px 0;
}

/* Instructions */
.revealInstructions{
  font-weight:700;
  font-size:14px;
  line-height:1.45;
  margin-bottom:10px;
}

/* Input */
.revealInput{
  width:100%;
  border:none;
  border-bottom:2px solid var(--ink);
  outline:none;
  font-size:16px;
  font-weight:900;
  background:transparent;
  padding:8px 2px;
}

.revealHint{
  color:var(--muted);
  font-weight:700;
  font-size:14px;
  letter-spacing:.02em;
}

/* Reveal line */
.revealLine{
  font-size:18px;
  font-weight:900;
  line-height:1.35;
  word-wrap:break-word;
  min-height:260px;
}

.revealWord.hidden{ color:#bbb; }
.revealWord.revealed{ color:#111; }

/* Emojis */
.emojiSpeak{
  font-size:1.4em;
  vertical-align:middle;
  margin-left:4px;
}

.emojiTitle{
  font-size:1.15em;
  vertical-align:middle;
  margin-left:6px;
}

/* Reflection */
.reflectionPrompt{
  margin-top:10px;
  color:var(--reflectionInk);
  font-size:15px;
  line-height:1.5;
}

.reflectionPrompt .star{
  font-weight:900;
  margin-right:6px;
}

.reflectionPrompt em{
  font-style:italic;
  font-weight:800;
}

textarea, input { font-family:inherit; }
</style>
</head>

<body>
<div class="wrap">
<section class="revealCard" aria-label="Rooted in the Word Scripture Memory Tool">

  <div class="revealTitle">
    Rooted in the Word <span class="emojiTitle">üå±</span>
  </div>

  <!-- Verse Source -->
  <div class="keyRow keyRowStacked">
    <div class="keyLabel">Verse source (used to generate initials)</div>
    <div class="btnRow">
  <button id="clearSource" class="miniBtn">Clear</button>
  <button id="toggleKey">Hide</button>
</div>
  </div>

  <textarea id="fullVerseKey" class="keyInput"
    placeholder="Paste the full verse here."></textarea>

  <div id="keyHiddenNote" class="keyHiddenNote" style="display:none;">
    ü´£ Verse source hidden. Click <b>Show</b> to view it.
  </div>

  <hr class="softRule" />

  <!-- Practice -->
  <div class="practiceRow">
    <div class="keyLabel">
      Say it out loud <span class="emojiSpeak">üó£Ô∏è</span>
    </div>
    <div class="btnRow">
      <button id="togglePractice" type="button">Show</button>
      <button id="toggleInitials" type="button" class="miniBtn">Hide initials</button>
      <button id="clearInitials" type="button" class="miniBtn">Clear initials</button>
    </div>
  </div>

  <div id="practiceWrap" style="display:none;">
    <div class="revealInstructions">
      Recite the verse out loud. As you speak, type the initials to reveal the verse below.
    </div>

    <input
      class="revealInput"
      id="revealInput"
      placeholder="Type initials as you speak"
      autocomplete="off"
      autocapitalize="off"
      autocorrect="off"
      spellcheck="false"
      inputmode="text"
    />

    <div class="revealHint" id="revealHint"></div>
    <div class="revealLine" id="revealLine"></div>

    <div class="reflectionPrompt" id="reflectionPrompt">
      <span class="star">‚ú¶</span><em></em>
    </div>
  </div>

  <div id="practiceHiddenNote" class="keyHiddenNote">
    ü´£ Practice hidden. Click <b>Show</b> when ready to recite &amp; reveal.
  </div>

</section>
</div>

<script>
/* Reflection prompts */
const reflectionPrompts = [
  "What does this reveal about God‚Äôs character?",
  "What does this show about God‚Äôs faithfulness?",
  "What does this verse assume is already true about God?",
  "What does this reveal about God‚Äôs authority?",
  "How does this verse reflect God‚Äôs holiness?",
  "How is Christ reflected or anticipated here?",
  "What does this verse deny about God?"
];

function dailyPrompt(){
  const d = Math.floor(Date.now() / 86400000);
  return reflectionPrompts[d % reflectionPrompts.length];
}

/* State */
let revealModel = null;
let keyHidden = false;
let practiceHidden = true;
let practiceArmed = false;
let initialsHidden = false;

/* Build model */
function buildRevealModel(text){
  const raw = (text || "").trim();

  const quoted = raw.match(/[‚Äú"]([^‚Äù"]+)[‚Äù"]/);
  const cleaned = quoted ? quoted[1] :
    raw
      .replace(/https?:\/\/\S+/gi,"")
      .replace(/\b(?:ESV|NIV|NASB|KJV|NKJV|CSB|NLT)\b/gi,"")
      .replace(/\b[A-Za-z]+\s+\d+:\d+\b/g,"")
      .replace(/(^|\s)[a-z](?=[A-Z])/g,"$1")
      .trim();

  const words = cleaned.split(/\s+/)
    .map(w => w.replace(/^[^a-zA-Z]+|[^a-zA-Z]+$/g,""))
    .filter(Boolean);

  return {
    tokens: words.map((w,i)=>({i,display:w,initial:w[0].toLowerCase()})),
    initials: words.map(w=>w[0].toUpperCase()).join(" "),
    state:{cursor:0,revealed:Array(words.length).fill(false)}
  };
}

/* DOM */
const fullVerseKey = document.getElementById("fullVerseKey");
const toggleKey = document.getElementById("toggleKey");
const keyHiddenNote = document.getElementById("keyHiddenNote");
const clearSource = document.getElementById("clearSource");

const togglePractice = document.getElementById("togglePractice");
const practiceWrap = document.getElementById("practiceWrap");
const practiceHiddenNote = document.getElementById("practiceHiddenNote");

const revealInput = document.getElementById("revealInput");
const revealHint = document.getElementById("revealHint");
const revealLine = document.getElementById("revealLine");

const clearInitials = document.getElementById("clearInitials");
const toggleInitials = document.getElementById("toggleInitials");
const reflectionPrompt = document.querySelector("#reflectionPrompt em");

/* Helpers */
function setKeyHidden(h){
  keyHidden=h;
  fullVerseKey.style.display=h?"none":"block";
  keyHiddenNote.style.display=h?"block":"none";
  toggleKey.textContent=h?"Show":"Hide";
}

function setPracticeHidden(h){
  practiceHidden=h;
  practiceWrap.style.display=h?"none":"block";
  practiceHiddenNote.style.display=h?"block":"none";
  togglePractice.textContent=h?"Show":"Hide";
}

function render(){
  if(!practiceArmed || !revealModel){
    revealHint.textContent="";
    revealLine.textContent="";
    return;
  }

  revealHint.textContent = initialsHidden ? "" : `Initials: ${revealModel.initials}`;

  revealLine.innerHTML = revealModel.tokens.map((t,i)=>{
    const shown=revealModel.state.revealed[i];
    return `<span class="revealWord ${shown?"revealed":"hidden"}">${
      shown?t.display:"‚Ä¢".repeat(Math.max(3,t.display.length))
    }</span>`;
  }).join(" ");
}

/* Events */
fullVerseKey.addEventListener("input",()=>{
  revealModel = buildRevealModel(fullVerseKey.value);
  practiceArmed=false;
  setPracticeHidden(true);
});

toggleKey.addEventListener("click",()=>setKeyHidden(!keyHidden));

clearSource.addEventListener("click",()=>{
  fullVerseKey.value="";
  revealModel=null;
  practiceArmed=false;
  setKeyHidden(false);
  setPracticeHidden(true);
  revealInput.value="";
  render();
  fullVerseKey.focus();
});

togglePractice.addEventListener("click",()=>{
  const show = practiceHidden;
  setPracticeHidden(!practiceHidden);
  if(show){
    practiceArmed=true;
    reflectionPrompt.textContent=dailyPrompt();
    render();
    revealInput.focus();
  }
});

toggleInitials.addEventListener("click",()=>{
  initialsHidden=!initialsHidden;
  toggleInitials.textContent=initialsHidden?"Show initials":"Hide initials";
  render();
});

revealInput.addEventListener("input",()=>{
  if(!practiceArmed || !revealModel) return;
  const letters = revealInput.value.toLowerCase().match(/[a-z]/g)||[];
  revealModel.state.cursor=0;
  revealModel.state.revealed.fill(false);
  for(const ch of letters){
    const i=revealModel.state.cursor;
    if(ch===revealModel.tokens[i]?.initial){
      revealModel.state.revealed[i]=true;
      revealModel.state.cursor++;
    } else break;
  }
  render();
});

clearInitials.addEventListener("click",()=>{
  if(!practiceArmed || !revealModel) return;
  revealModel.state.cursor=0;
  revealModel.state.revealed.fill(false);
  revealInput.value="";
  render();
  revealInput.focus();
});

/* Init */
setKeyHidden(false);
setPracticeHidden(true);
toggleInitials.textContent="Hide initials";
render();
</script>
</body>
</html>
